$(function(){$("div.control").caControl();$("#add_ques_182").text("Enter address");$("#edit_ques_182").text("Change address");controlCustomValidator.validationFor_ques_181=function(){};var g=function(m){var n=m.find(".defaultTextInput");if(n.length>0){n[0].focus()}};var a=$("#step1"),b=$("#step2"),k="",c=sessionStorage.ageUnder13Failed||false;(ageValidation=function(){var n="";c=sessionStorage.ageUnder13Failed;if(c){var o=a.hasClass("invisible")?2:1;if(o===1){n="Continue"}else{n="Create"}var m=$("#registerContinue");m.after('<input id="dummy" type="submit"  title="'+n+'" value="'+n+'" class="pa m-disable" />');m.remove();$message="The Common Application is for use by students 13 years of age or older. Please contact the colleges directly for instructions on how to apply.";$("#registrationErrors").removeClass("invisible").empty().append("<li>"+$message+"</li>")}})();g(a);$("div.jqCC").find("input:not(.jqHiddenValue)").on("blur",function(q){var s=$(this).closest("div.control").data("cao-options"),o=s.cid.replace(/9900/g,""),m=$("#validation_"+o),n=$("#validation_"+o+"9900"),r;if((m.text()=="")&&(n.text()=="")){if($(this).val()!=$("#value_"+o).val()){var p=o.substring(o.indexOf("_")+1);switch(p){case"187":r="Email addresses must match.";break;case"1":r="Passwords must match.";break}controlsFunc.showError(r,s.cid)}}});var e=function(){var m=$(this),n=a.hasClass("invisible")?2:1;if(n===1){l(m)}else{f(m)}};var h=function(m){m.preventDefault();m.stopPropagation();window.open("https://www.commonapp.org/ca4app/AppAccount/Register#!PublicPages/License","null","width=900,height=750,toolbar=no,scrollbars=yes,location=no,resizable=yes")};$("#linkLicense").on("click",h);var i=function(m){m.preventDefault();m.stopPropagation();window.open("https://www.commonapp.org/ca4app/AppAccount/Register#!PublicPages/PrivacyPolicy","null","width=900,height=750,toolbar=no,scrollbars=yes,location=no,resizable=yes")};$("#linkPrivacy").on("click",i);var j=function(n){var m=$(this),o=a.hasClass("invisible")?2:1;if(o===2){if(n){n.preventDefault()}a.removeClass("invisible");$([]).add(b).add($("#step1Complete")).addClass("invisible");$("#step2Li").removeClass("active");$(".pa").val("Continue");$(".pa").attr("title","Continue");m.text("Cancel");$("#registrationCancel").attr("title","Cancel");g(a);$("#password_ques_1").val("");$("#password_ques_19900").val("");$("#registrationErrors").empty().addClass("invisible");ageValidation()}};$("#registerContinue").on("click",e);$("#registrationCancel").on("click",j);var l=function(m){$("#registrationErrors").addClass("invisible").children().remove();controlsFunc.hideError("ques_1879900");controlsFunc.hideError("ques_19900");$("#email_ques_187").blur();$("#email_ques_1879900").blur();$("#password_ques_1").blur();$("#password_ques_19900").blur();var u=d(a);if(true===u){$message="Correct errors displayed prior to clicking Continue.";$("#registrationErrors").removeClass("invisible").empty().append("<li>"+$message+"</li>")}else{$(this).attr("disabled","disabled");var n=a.find("div.control").getValue().List,z=a.data("url");if(n.length===2){for(var w=0,x;x=n[w++];){var p="ques_"+x.QuestionId,o=p+"9900",v;if(!x.ConfirmValue){if(!$("#validation_"+o).html()){controlsFunc.showError(shd.consts.requiredMessage,o)}return false}else{if(x.Value!==x.ConfirmValue){switch(x.QuestionId){case"187":v="Email addresses must match.";break;case"1":v="Passwords must match.";break}controlsFunc.showError(v,o);return false}}}}else{return false}var s,q,y,r;for(var w=0,x;x=n[w++];){if(x.QuestionId==="187"){s=x.Value.trim();q=x.ConfirmValue.trim()}else{y=x.Value;r=x.ConfirmValue}}var t={email:s,confirmEmail:q,password:y,confirmPassword:r};m.off("click").addClass("m-disable");$.ajaxPost({url:z,data:t,callback:function(A){m.on("click",e).removeClass("m-disable");var B=A.Result;$(".tip").asToolTip();if(A.Result.HasError){$("#registrationErrors").renderWith(A.Result.Messages,html.amem).removeClass("invisible");$("#registrationErrors").find("div").removeClass("error")}else{a.addClass("invisible");$([]).add(b).add($("#step1Complete")).removeClass("invisible");$("#step2Li").addClass("active");$(".pa").val("Create");$(".pa").attr("title","Create");$("#registrationCancel").text("Back");$("#registrationCancel").attr("title","Back");g(b);if(k!=""){$("#registrationErrors").removeClass("invisible").empty().append("<li>"+k+"</li>")}}}})}return};var f=function(q){var r="ques_182",u,C="ques_189",y,t,A=false,v,z="ques_181",o,B="ques_180",n,w="ques_40000",D="ques_0",m,p;n=$("#value_"+B);n.val($("input:radio[name=radio_"+B+"]:checked").val());m=$("#value_"+w);m.val($("input:radio[name=radio_"+w+"]:checked").val());p=$("#value_"+D);p.val($("input:radio[name=radio_"+D+"]:checked").val());$("#registrationErrors").empty().addClass("invisible");$("#text_ques_173").blur();$("#text_ques_175").blur();controlsFunc.dateDropdownChangeEvent($("#month_ques_181"));controlsFunc.isRequiredAndValid($("#container_"+r),r);controlsFunc.isRequiredAndValid($("#container_"+B),B,n.val());controlsFunc.isValidPhone(C,"");controlsFunc.isRequiredAndValid($("#container_"+w),w,m.val());controlsFunc.isRequiredAndValid($("#container_"+D),D,p.val());y=$("#CommunicationOption").is(":checked");t=controlsFunc.multiSelectOptions($("#container_ques_70000"));controlsFunc.multiSelectTextAndValidation(t.cid,t);A=d(b);if(true===A){k="You must answer all required questions denoted by * and correct any errors before continuing with the creation of your account.";$("#registrationErrors").removeClass("invisible").empty().append("<li>"+k+"</li>")}else{v=b.find("div.control").getValue().List;var E=a.find("div.control").getValue().List;if(E.length>1){v.push(E[0]);v.push(E[1])}$dateOfBirth=$($.grep(v,function(F){return F.QuestionId==181})).attr("Value");var x=+new Date($dateOfBirth);var s=~~((Date.now()-x)/(31557600000));if(s<13){sessionStorage.ageUnder13Failed=true;ageValidation()}else{k="";vm={Answers:v,CommunicationOption:y,IsTestAccount:($.queryStringByName("ISTESTACCOUNT").toUpperCase()=="TRUE")};q.off("click").addClass("m-disable");$.ajaxPost({url:registrationUrl,contentType:"application/json",data:JSON.stringify(vm),dataType:"json",callback:function(F){if(F.Result.HasError){q.on("click",e).removeClass("m-disable");if(F.Result.ErrorCode==13){sessionStorage.ageUnder13Failed=true;ageValidation();return}else{if(F.Result.ErrorCode==1022){j()}}$("#registrationErrors").renderWith(F.Result.Messages,html.amem).removeClass("invisible");$("#registrationErrors").find("div").removeClass("error")}}})}}return false};var d=function(m){var n=false;$errors=m.find(".error").not(".invisible");$errors.each(function(){if($($(this)[0]).text().length>0){n=true}});return n}});